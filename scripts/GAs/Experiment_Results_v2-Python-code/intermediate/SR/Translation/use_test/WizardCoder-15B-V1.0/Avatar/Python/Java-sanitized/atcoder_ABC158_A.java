import java.net.HttpURLConnection;
import java.net.URL;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Base64;
import java.util.Random;
import java.util.concurrent.TimeUnit;

import org.apache.commons.lang3.time.DateUtils;
import org.apache.http.client.methods.CloseableHttpResponse;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.util.EntityUtils;
import org.json.JSONObject;

import com.google.crypto.tink.Fernet;
import com.google.crypto.tink.aead.AeadConfig;
import com.google.crypto.tink.aead.AeadKeyTemplates;
import com.google.crypto.tink.config.TinkConfig;
import com.google.crypto.tink.integration.gcpkms.GcpKmsClient;
import com.google.crypto.tink.integration.gcpkms.GcpKmsClient.GcpKmsClientFactory;
import com.google.crypto.tink.integration.gcpkms.GcpKmsKeyManager;
import com.google.crypto.tink.proto.KeyTemplate;
import com.google.crypto.tink.proto.Keyset;
import com.google.crypto.tink.proto.Keyset.Key;
import com.google.crypto.tink.proto.Keyset.Key.KeyData;
import com.google.crypto.tink.proto.Keyset.Key.OutputPrefixType;
import com.google.crypto.tink.proto.Keyset.Key.Status;
import com.google.crypto.tink.proto.Keyset.Key.Type;
import com.google.crypto.tink.proto.Keyset.Key.Value;
import com.google.crypto.tink.proto.Keyset.Key.Value.EncKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.SecretKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.SymmetricKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.Unencrypted;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.KeyMaterialType;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.OutputPrefixType as OutputPrefixTypeUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.Status as StatusUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.Type as TypeUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey as UserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.Builder;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.KeyMaterialType as KeyMaterialTypeUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.OutputPrefixType as OutputPrefixTypeUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.Status as StatusUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.Type as TypeUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey as UserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.Builder;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.KeyMaterialType as KeyMaterialTypeUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.OutputPrefixType as OutputPrefixTypeUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.Status as StatusUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.Type as TypeUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey as UserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.Builder;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.KeyMaterialType as KeyMaterialTypeUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.OutputPrefixType as OutputPrefixTypeUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.Status as StatusUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.Type as TypeUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey as UserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.Builder;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.KeyMaterialType as KeyMaterialTypeUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.OutputPrefixType as OutputPrefixTypeUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.Status as StatusUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.Type as TypeUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey as UserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Builder;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.KeyMaterialType as KeyMaterialTypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.OutputPrefixType as OutputPrefixTypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Status as StatusUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Type as TypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey as UserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Builder;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.KeyMaterialType as KeyMaterialTypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.OutputPrefixType as OutputPrefixTypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Status as StatusUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Type as TypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey as UserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Builder;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.KeyMaterialType as KeyMaterialTypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.OutputPrefixType as OutputPrefixTypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Status as StatusUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Type as TypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey as UserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Builder;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.KeyMaterialType as KeyMaterialTypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.OutputPrefixType as OutputPrefixTypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Status as StatusUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Type as TypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey as UserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Builder;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.KeyMaterialType as KeyMaterialTypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.OutputPrefixType as OutputPrefixTypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Status as StatusUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Type as TypeUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey as UserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKeyUserKey;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey.Builder;
import com.google.crypto.tink.proto.Keyset.Key.Value.UserKey.UserKey.UserKey.UserKey.UserKey.UserKey